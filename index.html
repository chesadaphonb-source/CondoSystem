<script>
    // คัดลอกค่า Web App URL ที่ได้จากขั้นตอนที่ 1 มาวางตรงนี้
    const SCRIPT_URL = 'ใส่_WEB_APP_URL_ของคุณที่นี่';

    const defaultConfig = {
      project_name: 'THE ELEGANCE',
      tagline: 'LUXURY LIVING REDEFINED',
      hero_title: 'THE ELEGANCE RESIDENCE',
      contact_title: 'ลงทะเบียนรับข้อมูล'
    };

    let leads = [];

    // ฟังก์ชันจำลอง SDK เพื่อให้กระทบโค้ดเดิมน้อยที่สุด
    const dataSdkShim = {
      async create(data) {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'create', ...data })
        });
        await refreshData();
        return { isOk: response.ok };
      },
      async update(data) {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'update', ...data })
        });
        await refreshData();
        return { isOk: response.ok };
      },
      async delete(data) {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'delete', ...data })
        });
        await refreshData();
        return { isOk: response.ok };
      }
    };

    async function refreshData() {
      try {
        const response = await fetch(SCRIPT_URL);
        leads = await response.json();
        document.getElementById('lead-count').textContent = `${leads.length} รายการ`;
        renderLeads();
      } catch (e) {
        console.error("Fetch error:", e);
      }
    }

    // แก้ไข initApp เดิม
    async function initApp() {
      // โหลดข้อมูลครั้งแรก
      refreshData();
      
      // ตั้งค่า UI เริ่มต้น
      document.getElementById('nav-logo').textContent = defaultConfig.project_name;
      document.getElementById('hero-tagline').textContent = defaultConfig.tagline;
      // ... ตั้งค่าอื่นๆ ตามโค้ดเดิมของคุณ ...
    }

    // แทนที่การเรียก window.dataSdk ด้วย dataSdkShim
    const activeDataService = dataSdkShim;

    // --- ส่วนฟังก์ชัน Render และ Event ต่างๆ (ยกมาจากโค้ดส่วนที่ 2 ของคุณ) ---
    function renderLeads() {
      const container = document.getElementById('leads-container');
      const noLeads = document.getElementById('no-leads');
      
      if (leads.length === 0) {
        container.innerHTML = '';
        noLeads.classList.remove('hidden');
        return;
      }
      noLeads.classList.add('hidden');

      const sortedLeads = [...leads].sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

      container.innerHTML = sortedLeads.map(lead => `
        <div class="bg-[#1a1a1a] border border-[#c9a961]/20 p-6" data-lead-id="${lead.__backendId}">
          <div class="flex flex-wrap items-start justify-between gap-4">
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-3 mb-2">
                <h4 class="font-display text-xl text-white truncate">${escapeHtml(lead.name)}</h4>
                <span class="px-2 py-1 text-xs ${lead.status === 'new' ? 'bg-green-600/20 text-green-400' : lead.status === 'contacted' ? 'bg-blue-600/20 text-blue-400' : 'bg-gray-600/20 text-gray-400'}">
                  ${lead.status === 'new' ? 'ใหม่' : lead.status === 'contacted' ? 'ติดต่อแล้ว' : 'ปิดการขาย'}
                </span>
              </div>
              <div class="grid md:grid-cols-3 gap-4 text-sm">
                <div><span class="text-gray-500">อีเมล:</span> <span class="text-gray-300 ml-2">${escapeHtml(lead.email)}</span></div>
                <div><span class="text-gray-500">โทร:</span> <span class="text-gray-300 ml-2">${escapeHtml(lead.phone)}</span></div>
                <div><span class="text-gray-500">ห้อง:</span> <span class="text-[#c9a961] ml-2">${escapeHtml(lead.unit_interest || lead.unit)}</span></div>
              </div>
              ${lead.message ? `<p class="text-gray-400 text-sm mt-3 italic">"${escapeHtml(lead.message)}"</p>` : ''}
            </div>
            <div class="flex items-center gap-2">
              <select onchange="updateLeadStatus('${lead.__backendId}', this.value)" class="bg-[#0a0a0a] border border-[#c9a961]/30 px-3 py-2 text-sm text-white">
                <option value="new" ${lead.status === 'new' ? 'selected' : ''}>ใหม่</option>
                <option value="contacted" ${lead.status === 'contacted' ? 'selected' : ''}>ติดต่อแล้ว</option>
                <option value="closed" ${lead.status === 'closed' ? 'selected' : ''}>ปิดการขาย</option>
              </select>
              <button onclick="confirmDeleteLead('${lead.__backendId}')" class="text-red-400 hover:text-red-300 p-2">ลบ</button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // แก้ไขฟังก์ชันการส่งฟอร์ม (Submit)
    document.getElementById('contact-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const submitBtn = document.getElementById('submit-btn');
      submitBtn.disabled = true;
      
      const leadData = {
        name: document.getElementById('input-name').value,
        email: document.getElementById('input-email').value,
        phone: document.getElementById('input-phone').value,
        unit_interest: document.getElementById('input-unit').value || 'ยังไม่ระบุ',
        budget: document.getElementById('input-budget').value || 'ยังไม่ระบุ',
        message: document.getElementById('input-message').value || '',
        created_at: new Date().toISOString(),
        status: 'new'
      };

      const result = await activeDataService.create(leadData);
      if (result.isOk) {
        showToast('ลงทะเบียนสำเร็จ!');
        e.target.reset();
      } else {
        showToast('เกิดข้อผิดพลาด', 'error');
      }
      submitBtn.disabled = false;
    });

    async function updateLeadStatus(id, status) {
      await activeDataService.update({ __backendId: id, status: status });
      showToast('อัปเดตสถานะแล้ว');
    }

    async function deleteLead(id) {
      await activeDataService.delete({ __backendId: id });
      showToast('ลบข้อมูลแล้ว');
    }

    // ฟังก์ชันอื่นๆ (showToast, escapeHtml, confirmDeleteLead) ให้คงเดิมไว้ตามที่คุณส่งมา
    function showToast(m, t='success'){ /* ... โค้ดเดิม ... */ }
    function escapeHtml(t){ /* ... โค้ดเดิม ... */ }
    function confirmDeleteLead(id){ /* ... โค้ดเดิม ... */ }

    // เริ่มต้นแอป
    initApp();
</script>